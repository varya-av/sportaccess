<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–æ–∏ –∑–∞–ø–∏—Å–∏</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="top-bar">
        <h2>–ú–æ–∏ –∑–∞–ø–∏—Å–∏: {{ user.first_name }} {{ user.last_name }}</h2>
        <div class="profile-container" onclick="toggleProfilePopup()">
            <span class="profile-name">{{ user.first_name }} {{ user.last_name }}</span>
            <div class="profile-popup" id="profile-popup">
                <a href="/logout">üö™ –í—ã–π—Ç–∏</a>
                <form method="POST" action="/delete-profile" onsubmit="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –∏ –≤—Å–µ –∑–∞–ø–∏—Å–∏?');">
                    <button type="submit" class="btn-danger">‚ùå –£–¥–∞–ª–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</button>
                </form>
            </div>
        </div>
    </div>

    <div class="nav-link">
        <a href="/main">‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
    </div>

    {% if bookings %}
        <table class="booking-table">
            <thead>
                <tr>
                    <th>–î–∞—Ç–∞</th>
                    <th>–í—Ä–µ–º—è</th>
                    <th>–ü–ª–æ—â–∞–¥–∫–∞</th>
                    <th>–ê–¥—Ä–µ—Å</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody>
                {% for b in bookings %}
                <tr>
                    <td>{{ b.date }}</td>
                    <td>{{ b.time }}</td>
                    <td>{{ b.ground.school_name }}</td>
                    <td>{{ b.ground.address }}</td>
                    <td>
                        <a href="/{{ b.qr_code_path }}" target="_blank">QR</a>
                        <a href="/static/pdf/booking_{{ b.user_id }}_{{ b.ground_id }}_{{ b.date }}_{{ b.time.replace(':','') }}.pdf" target="_blank">PDF</a>
                        <a href="/cancel-booking/{{ b.id }}" onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–º–µ–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å?')">–£–¥–∞–ª–∏—Ç—å</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <div class="no-bookings">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π.</div>
    {% endif %}

    <script>
        function toggleProfilePopup() {
            const popup = document.getElementById("profile-popup");
            popup.style.display = (popup.style.display === "block") ? "none" : "block";
        }
        window.addEventListener("click", function(e) {
            if (!e.target.closest(".profile-container")) {
                const popup = document.getElementById("profile-popup");
                if (popup) popup.style.display = "none";
            }
        });
    </script>
</body>
</html>